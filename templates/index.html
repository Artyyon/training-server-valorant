<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TICS - Treino Inteligente de Contadores</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="shortcut icon" type="image/jpg" href="/static/image/ico.jpg"/>
</head>
<body>
    <div class="header">
        <h1>TICS - Treino Inteligente de Contadores</h1>
    </div>
    <div class="container">
        <!-- Gerar cards dinamicamente com Jinja -->
        {% for training in trainings %}
        <div class="card">
            <h2>{{ training.name }}</h2>
            <ul>
                <!-- Gerar contadores dinamicamente -->
                {% for counter in training.counters %}
                <li>{{ counter.name }}: <span id="counter-{{ training.id }}-{{ counter.id }}">{{ counter.count }}</span> / {{ counter.max_count }}</li>
                <div class="btn-group">
                    <button class="btn" onclick="increment('counter-{{ training.id }}-{{ counter.id }}', {{ counter.max_count }}, {{ training.id }}, {{ counter.id }})">Incrementar</button>
                    <button class="btn-reset" onclick="resetCount('counter-{{ training.id }}-{{ counter.id }}', {{ training.id }}, {{ counter.id }})">Resetar</button>
                </div>
                {% endfor %}
                <button class="btn-reset-all" onclick="resetAll({{ training.id }})">Resetar todos os contadores</button>
            </ul>
        </div>
        {% endfor %}
    </div>

    <script>
        // Função para incrementar um contador
        function increment(id, max, trainingId, counterId) {
            var span = document.getElementById(id);
            var count = parseInt(span.textContent);
            if (count < max) {
                span.textContent = count + 1;
                // Enviar atualização para o servidor
                fetch('/update-counter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        training_id: trainingId,
                        counter_id: counterId
                    })
                });
            }
        }

        // Função para resetar um contador
        function resetCount(id, trainingId, counterId) {
            document.getElementById(id).textContent = '0';
            // Enviar reset para o servidor
            fetch('/reset-counter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    training_id: trainingId,
                    counter_id: counterId
                })
            });
        }

        // Função para resetar todos os contadores de um treino
        function resetAll(trainingId) {
            var spans = document.querySelectorAll(`span[id^='counter-${trainingId}']`);
            spans.forEach(span => span.textContent = '0');
            // Enviar reset de todos os contadores para o servidor
            fetch('/reset-counter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    training_id: trainingId,
                    counter_id: -1
                })
            });
        }
    </script>
</body>
</html>
